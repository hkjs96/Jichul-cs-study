# CRDT (conflict-free replicated data type)
- 분산 컴퓨팅 에서 CRDT ( 충돌 없는 복제 데이터 유형 )는 네트워크 의 여러 컴퓨터에 걸쳐 복제 될 수 있는 데이터 구조
- 복제본 간의 조정 없이 복제본이 독립적으로 동시에 업데이트될 수 있으며 항상 수학적으로 유지
- 발생할 수 있는 불일치를 해결

<img src="https://user-images.githubusercontent.com/75015048/151672850-75c72204-cab6-4088-8344-a96fdfc490c1.png" width="80%" />

## 예시
- 로컬 장치에 데이터를 저장하고 해당 데이터를 동일한 사용자에게 속한 다른 장치(예: 캘린더, 메모, 연락처 또는 미리 알림)와 동기화해야 하는 모바일 앱
- 일부 복제본이 오프라인 상태인 경우에도 시스템이 계속 올바르게 작동하도록 데이터의 여러 복제본(동일한 데이터 센터 또는 다른 위치에서)을 유지 관리하는 분산 데이터베이스.
- 여러 사용자가 동일한 파일이나 데이터를 동시에 변경할 수 있는 Google 문서도구, Trello, Figma 또는 기타 많은 공동 작업 소프트웨어
- 글로벌 확장성을 달성하기 위해 데이터를 복제하는 대규모 데이터 저장 및 처리 시스템.

- 충돌 해결을 처리하는 낙관적 복제가 있는 시스템에서 사용
- CRDT는 다른 복제본에서 어떤 데이터 수정이 이루어지더라도 데이터가 항상 일관된 상태로 병합될 수 있어야하며 이 병합은 특별한 충돌 해결 코드나 사용자 개입 없이 CRDT에 의해 자동 수행

## 데이터 수정을 처리하는 두 가지 접근 방식 
### 강력한 일관성 복제 (Strongly consistent replication)
- 복제본은 수정 사항을 적용할 시기와 방법을 결정하기 위해 서로 조정
- 직렬화 가능한 트랜잭션 및 선형화 가능성과 같은 강력한 일관성 모델이 가능
- 조정을 기다리면 시스템의 성능이 저하됨.
- CAP 정리는 복제본이 시스템의 나머지 부분과 연결이 끊긴 동안(예: 네트워크 파티션으로 인해 또는 간헐적으로 연결되는 모바일 장치이기 때문에) 복제본에서 데이터를 변경할 수 없다.
### 낙관적 복제 (Optimistic replication)
- 사용자는 복제본이 오프라인 상태이거나 다른 복제본과 연결이 끊긴 경우에도 다른 복제본과 독립적으로 복제본의 데이터를 수정 가능
- 성능과 가용성을 극대화할 수 있지만 여러 클라이언트 또는 사용자가 동일한 데이터 조각을 동시에 수정할 경우 충돌이 발생할 수 있으며 복제본이 서로 통신할 때 충돌을 해결해야한다.

## CRDT의 유형
### 작업 기반 CRDT ( Operation-based CRDTs )
- 교환 복제 데이터 유형 또는 CmRDT라 한다.
- CmRDT 복제본은 업데이트 작업만 전송하여 상태를 전파
- 예를 들어, 단일 정수의 CmRDT는 연산 (+10) 또는 (-20)을 브로드캐스트할 수 있습니다. 복제본은 업데이트를 수신하고 로컬로 적용합니다. 연산은 교환 가능 합니다. 그러나 반드시 멱등성이 있는 것은 아닙니다 . 따라서 복제본에 대한 모든 작업이 복제 없이 순서에 관계없이 다른 복제본에 전달되도록 해야 합니다.

### 상태 기반 CRDT ( State-based CRDTs )
- 수렴형 복제 데이터 유형 또는 CvRDT라 한다.
- CmRDT와 달리 CvRDT는 전체 로컬 상태를 다른 복제본에 보낸다.
- 여기서 상태는 가환성, 연관성 및 멱등성 이어야 하는 함수에 의해 병합되며 병합 기능은 모든 복제본 상태 쌍에 대한 조인 을 제공하므로 모든 상태 집합이 반격자를 형성.
- 업데이트 기능은 Semilattice와 동일한 부분 순서 규칙에 따라 내부 상태를 단조롭게 증가시킴.

### 비교 
- CmRDT는 복제본 간의 작업 전송을 위한 프로토콜에 대한 요구 사항이 더 많지만 내부 상태의 크기에 비해 트랜잭션 수가 적은 경우 CvRDT보다 대역폭을 덜 사용
- CvRDT 병합 기능은 연관적이므로 일부 복제본의 상태와 병합하면 해당 복제본에 대한 모든 이전 업데이트가 생성됨.
- 가십 프로토콜은 네트워크 사용을 줄이고 토폴로지 변경을 처리하면서 CvRDT 상태를 다른 복제본에 전파하는데 적합하다.


# 용어
- Replicated : 복제된

- 레플리카 : 사본

- CAP 정리, 브루어의 정리(Brewer -) : 다음과 같은 세 가지 조건을 모두 만족하는 분산 컴퓨터 시스템이 존재하지 않음을 증명한 정리
  - 일관성(Consistency): 모든 노드가 같은 순간에 같은 데이터를 볼 수 있다.
  - 가용성(Availability): 모든 요청이 성공 또는 실패 결과를 반환할 수 있다.
  - 분할내성(Partition tolerance): 메시지 전달이 실패하거나 시스템 일부가 망가져도 시스템이 계속 동작할 수 있다.

- 가십 프로토콜 : 전염병 확산 방식을 기반으로 하는 컴퓨터 P2P 통신의 절차 또는 프로세스입니다.

- Semilattice:  비어 있지 않은 유한 부분 집합 에 대한 결합 ( 최소 상한 ) 이 있는 부분적으로 정렬 된 집합

# 참고 
[CRDT - 위키](https://en.wikipedia.org/wiki/Conflict-free_replicated_data_type)

[crdt.tech](https://crdt.tech/#about-crdts)

[CRDT: 충돌 없는 복제 데이터 유형 - 안톤 자고르스키](https://medium.com/@amberovsky/crdt-conflict-free-replicated-data-types-b4bfc8459d26)

[CRDT 기반 데이터베이스를 사용해야하는 경우](https://kor.small-business-tracker.com/when-use-crdt-based-database-542900)

[CRDT 와 OT](https://channel.io/ko/blog/crdt_vs_ot)

[CAP 정리](https://ko.wikipedia.org/wiki/CAP_%EC%A0%95%EB%A6%AC)
